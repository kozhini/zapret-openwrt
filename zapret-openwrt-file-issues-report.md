# –û—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–∞—Ö –≤ —Å–≤—è–∑—è—Ö —Ñ–∞–π–ª–æ–≤ zapret-openwrt

## –ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å OpenWrt 24.10 aarch64_cortex-a53

### üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:

#### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–∞—Ç–∞ –≤ PKG_SOURCE_DATE**
**–§–∞–π–ª—ã:** –í—Å–µ Makefile –ø–∞–∫–µ—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** `PKG_SOURCE_DATE:=2025-08-20` - –¥–∞—Ç–∞ –≤ –±—É–¥—É—â–µ–º
```makefile
# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
PKG_SOURCE_DATE:=2025-08-20

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
PKG_SOURCE_DATE:=2024-08-20
```

#### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ PKG_HASH –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
**–§–∞–π–ª—ã:** –í—Å–µ Makefile –ø–∞–∫–µ—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–∞
```makefile
# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
#PKG_HASH:=skip

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
PKG_HASH:=<actual_hash_value>
```

#### 3. **–ü—Ä–æ–±–ª–µ–º—ã —Å eBPF –∫–æ–º–ø–∏–ª—è—Ü–∏–µ–π –¥–ª—è aarch64**
**–§–∞–π–ª:** `zapret-ebpf/Makefile`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `$(ARCH)` –≤–º–µ—Å—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
```makefile
# –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ:
$(CLANG) -O2 -g -target bpf -D__TARGET_ARCH_$(ARCH) -c $$f -o $$out

# –î–ª—è aarch64 –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
$(CLANG) -O2 -g -target bpf -D__TARGET_ARCH_aarch64 -c $$f -o $$out
```

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 4. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
**–§–∞–π–ª:** `luci-app-zapret/Makefile`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `uhttpd` –≤–º–µ—Å—Ç–æ `nginx` (OpenWrt 24.10)
```makefile
# –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ OpenWrt 24.10:
[ -f "/etc/init.d/uhttpd" ] && /etc/init.d/uhttpd reload

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
[ -f "/etc/init.d/nginx" ] && /etc/init.d/nginx reload
```

#### 5. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—É—Ç—è–º–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏**
**–§–∞–π–ª:** `zapret/Makefile`
**–ü—Ä–æ–±–ª–µ–º–∞:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ `/opt/zapret` –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—É—Ç–µ–π OpenWrt
```makefile
# –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—É—Ç—å:
$(INSTALL_DIR) $(1)/opt/zapret

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
$(INSTALL_DIR) $(1)/usr/bin
$(INSTALL_DIR) $(1)/etc/zapret
```

#### 6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å aarch64_cortex-a53
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤ Makefile:
```makefile
ifeq ($(ARCH),aarch64)
  # aarch64 specific settings
  PKG_ARCH:=$(ARCH)
else
  $(error Unsupported architecture: $(ARCH))
endif
```

### üîß –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:

#### 7. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
**–§–∞–π–ª:** `zapret/Makefile`
```makefile
# –ú–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –≤ OpenWrt 24.10:
DEPENDS+= +kmod-nft-nat +kmod-nft-offload +kmod-nft-queue
DEPENDS+= +libnetfilter-queue
```

#### 8. **–ü—Ä–æ–±–ª–µ–º—ã —Å eBPF –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏**
**–§–∞–π–ª:** `zapret-ebpf/Makefile`
```makefile
# –ú–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ OpenWrt 24.10:
DEPENDS:= +libelf +zlib +libbpf +kmod-sched-core
```

### üìÅ –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

#### 9. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã**
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `zapret-ebpf/Makefile` —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:
```makefile
$(INSTALL_BIN) ./files/etc/init.d/zapret-ebpf $(1)/etc/init.d/zapret-ebpf
$(INSTALL_CONF) ./files/etc/config/zapret-ebpf $(1)/etc/config/zapret-ebpf
```

#### 10. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞**
**–§–∞–π–ª:** `zapret/Makefile`
**–ü—Ä–æ–±–ª–µ–º–∞:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
```makefile
# –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
chmod 644 $(1)/opt/zapret/ipset/*.txt
chmod 755 $(1)/opt/zapret/*.sh
```

### üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é:

#### 1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞—Ç—ã –∏ —Ö–µ—à–∏:**
```makefile
PKG_SOURCE_DATE:=2024-08-20
PKG_HASH:=<calculate_actual_hash>
```

#### 2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**
```makefile
ifeq ($(ARCH),aarch64)
  PKG_ARCH:=$(ARCH)
  TARGET_ARCH:=aarch64
else
  $(error Unsupported architecture: $(ARCH))
endif
```

#### 3. **–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```makefile
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –≤ OpenWrt 24.10:
DEPENDS:= +nftables +curl +gzip +coreutils +libcap +zlib
```

#### 4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
```makefile
$(INSTALL_DIR) $(1)/usr/bin
$(INSTALL_DIR) $(1)/etc/zapret
$(INSTALL_DIR) $(1)/etc/init.d
```

#### 5. **–û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:**
```makefile
# –í postinst:
[ -f "/etc/init.d/nginx" ] && /etc/init.d/nginx reload
[ -f "/etc/init.d/uhttpd" ] && /etc/init.d/uhttpd reload
```

### üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å PKG_SOURCE_DATE –Ω–∞ 2024-08-20
- [ ] –î–æ–±–∞–≤–∏—Ç—å PKG_HASH –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å eBPF –∫–æ–º–ø–∏–ª—è—Ü–∏—é –¥–ª—è aarch64
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è OpenWrt 24.10
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å nginx/uhttpd
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É –Ω–∞ aarch64_cortex-a53

### üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–º–µ—à–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–µ –∏ —Ä–∞–±–æ—Ç–µ –Ω–∞ OpenWrt 24.10 —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π aarch64_cortex-a53. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–∞–Ω—ã —Å –¥–∞—Ç–∞–º–∏, —Ö–µ—à–∞–º–∏, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ.